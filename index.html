<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holographic Inversion</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Load Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-950">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Inline Icons ---
        const Activity = ({size=24}) => <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>;
        const Play = ({size=18}) => <svg width={size} height={size} fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>;
        const Pause = ({size=18}) => <svg width={size} height={size} fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>;
        const Settings = ({size=16}) => <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
        const Target = ({size=16}) => <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>;
        const Info = ({size=14}) => <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
        const RefreshCw = ({size=16}) => <svg width={size} height={size} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;

        const App = () => {
          // --- Simulation State ---
          const [isRunning, setIsRunning] = useState(false);
          const [precision, setPrecision] = useState(0.001);
          const [inversionRadius, setInversionRadius] = useState(150);
          const [speed, setSpeed] = useState(2);
          const [windingNumber, setWindingNumber] = useState(0);
          const [cornerHits, setCornerHits] = useState(0);
          const [trailLength, setTrailLength] = useState(5000);
          const [showInversionCircle, setShowInversionCircle] = useState(true);

          // --- Refs for Animation & Canvas ---
          const canvasRef = useRef(null);
          const requestRef = useRef(null);
          const stateRef = useRef({
            pos: { x: 50, y: 50 },
            vel: { x: 1.5, y: 1.2 },
            path: [],
            bounds: { size: 300 }
          });

          // --- Initialization ---
          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;

            const handleResize = () => {
              const container = canvas.parentElement;
              if (container) {
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
              }
            };

            window.addEventListener('resize', handleResize);
            // Small timeout to ensure container has rendered its height
            setTimeout(handleResize, 100); 

            return () => window.removeEventListener('resize', handleResize);
          }, []);

          // --- Geometric Inversion Logic ---
          const invertPoint = (x, y, cx, cy, r) => {
            const dx = x - cx;
            const dy = y - cy;
            const distSq = dx * dx + dy * dy;
            if (distSq === 0) return { x, y };
            const factor = (r * r) / distSq;
            return {
              x: cx + dx * factor,
              y: cy + dy * factor
            };
          };

          // --- Main Simulation Loop ---
          const update = () => {
            const s = stateRef.current;
            const canvas = canvasRef.current;
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            const halfSize = s.bounds.size / 2;

            for (let i = 0; i < speed; i++) {
              s.pos.x += s.vel.x;
              s.pos.y += s.vel.y;

              const left = cx - halfSize;
              const right = cx + halfSize;
              const top = cy - halfSize;
              const bottom = cy + halfSize;

              let hitCornerX = false;
              let hitCornerY = false;

              if (s.pos.x <= left || s.pos.x >= right) {
                s.vel.x *= -1;
                s.pos.x = s.pos.x <= left ? left : right;
                if (Math.abs(s.pos.y - top) < 5 || Math.abs(s.pos.y - bottom) < 5) hitCornerX = true;
              }
              if (s.pos.y <= top || s.pos.y >= bottom) {
                s.vel.y *= -1;
                s.pos.y = s.pos.y <= top ? top : bottom;
                if (Math.abs(s.pos.x - left) < 5 || Math.abs(s.pos.x - right) < 5) hitCornerY = true;
              }

              if (hitCornerX || hitCornerY) {
                setCornerHits(prev => prev + 1);
                setWindingNumber(prev => prev + (s.vel.x * s.vel.y > 0 ? 1 : -1));
              }

              const inverted = invertPoint(s.pos.x, s.pos.y, cx, cy, inversionRadius);
              s.path.push(inverted);
              if (s.path.length > trailLength) s.path.shift();
            }

            // Render
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (showInversionCircle) {
              ctx.beginPath();
              ctx.arc(cx, cy, inversionRadius, 0, Math.PI * 2);
              ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
              ctx.setLineDash([5, 5]);
              ctx.stroke();
              ctx.setLineDash([]);
            }

            ctx.strokeStyle = 'rgba(59, 130, 246, 0.5)';
            ctx.strokeRect(cx - halfSize, cy - halfSize, s.bounds.size, s.bounds.size);

            if (s.path.length > 1) {
              ctx.beginPath();
              ctx.moveTo(s.path[0].x, s.path[0].y);
              for (let i = 1; i < s.path.length; i++) {
                ctx.lineTo(s.path[i].x, s.path[i].y);
              }
              const gradient = ctx.createRadialGradient(cx, cy, 10, cx, cy, inversionRadius * 2);
              gradient.addColorStop(0, 'rgba(139, 92, 246, 0.8)');
              gradient.addColorStop(1, 'rgba(236, 72, 153, 0.1)');
              ctx.strokeStyle = gradient;
              ctx.lineWidth = 1.5;
              ctx.stroke();
            }

            const currentInv = invertPoint(s.pos.x, s.pos.y, cx, cy, inversionRadius);
            ctx.beginPath();
            ctx.arc(currentInv.x, currentInv.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#f472b6';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#f472b6';
            ctx.fill();
            ctx.shadowBlur = 0;

            requestRef.current = requestAnimationFrame(update);
          };

          useEffect(() => {
            if (isRunning) {
              requestRef.current = requestAnimationFrame(update);
            } else {
              if (requestRef.current) cancelAnimationFrame(requestRef.current);
            }
            return () => {
              if (requestRef.current) cancelAnimationFrame(requestRef.current);
            };
          }, [isRunning, speed, inversionRadius, trailLength]);

          const resetSimulation = () => {
            const canvas = canvasRef.current;
            if (canvas) {
              stateRef.current.path = [];
              stateRef.current.pos = { x: canvas.width / 2 + 20, y: canvas.height / 2 + 20 };
              setCornerHits(0);
              setWindingNumber(0);
            }
          };

          return (
            <div className="flex flex-col h-screen bg-slate-950 text-slate-100 font-sans overflow-hidden">
              <header className="flex flex-wrap items-center justify-between px-4 md:px-6 py-4 bg-slate-900/50 border-b border-slate-800 backdrop-blur-md z-10 gap-4">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-indigo-500/20 rounded-lg text-indigo-400">
                    <Activity size={24} />
                  </div>
                  <div>
                    <h1 className="text-lg md:text-xl font-bold tracking-tight">Holographic Inversion</h1>
                    <p className="text-[10px] md:text-xs text-slate-400 uppercase tracking-widest font-medium">Billiard Square</p>
                  </div>
                </div>

                <div className="flex items-center gap-3 md:gap-4 w-full md:w-auto justify-between md:justify-end">
                  <div className="flex items-center gap-4 px-4 py-2 bg-slate-800/40 rounded-full border border-slate-700/50">
                    <div className="flex flex-col items-center">
                      <span className="text-[9px] text-slate-500 uppercase font-bold">Winding</span>
                      <span className="text-sm font-mono text-emerald-400">{windingNumber}</span>
                    </div>
                    <div className="w-px h-6 bg-slate-700"></div>
                    <div className="flex flex-col items-center">
                      <span className="text-[9px] text-slate-500 uppercase font-bold">Corners</span>
                      <span className="text-sm font-mono text-amber-400">{cornerHits}</span>
                    </div>
                  </div>
                  
                  <button 
                    onClick={() => setIsRunning(!isRunning)}
                    className={`flex items-center gap-2 px-5 py-2 rounded-full font-bold transition-all text-sm ${
                      isRunning 
                      ? 'bg-rose-500 hover:bg-rose-600 shadow-lg shadow-rose-500/20' 
                      : 'bg-indigo-500 hover:bg-indigo-600 shadow-lg shadow-indigo-500/20'
                    }`}
                  >
                    {isRunning ? <Pause size={16} /> : <Play size={16} />}
                    <span className="hidden sm:inline">{isRunning ? 'Pause' : 'Start'}</span>
                  </button>
                </div>
              </header>

              <main className="flex-1 flex flex-col md:flex-row relative overflow-hidden">
                <aside className="w-full md:w-80 bg-slate-900/30 border-b md:border-b-0 md:border-r border-slate-800 p-4 md:p-6 overflow-y-auto backdrop-blur-sm z-10 max-h-[35vh] md:max-h-none">
                  <section className="space-y-6">
                    <div>
                      <div className="flex items-center gap-2 mb-3 text-slate-400">
                        <Settings size={16} />
                        <h2 className="text-xs font-bold uppercase tracking-wider">Parameters</h2>
                      </div>
                      
                      <div className="space-y-4">
                        <div className="space-y-2">
                          <div className="flex justify-between text-xs">
                            <label className="text-slate-400 font-medium">Inversion Radius</label>
                            <span className="text-indigo-400 font-mono">{inversionRadius}px</span>
                          </div>
                          <input 
                            type="range" min="50" max="300" value={inversionRadius} 
                            onChange={(e) => setInversionRadius(parseInt(e.target.value))}
                            className="w-full accent-indigo-500 h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
                          />
                        </div>

                        <div className="space-y-2">
                          <div className="flex justify-between text-xs">
                            <label className="text-slate-400 font-medium">Speed</label>
                            <span className="text-indigo-400 font-mono">x{speed}</span>
                          </div>
                          <input 
                            type="range" min="1" max="10" value={speed} 
                            onChange={(e) => setSpeed(parseInt(e.target.value))}
                            className="w-full accent-indigo-500 h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
                          />
                        </div>

                        <div className="space-y-2">
                          <div className="flex justify-between text-xs">
                            <label className="text-slate-400 font-medium">Trail Resolution</label>
                            <span className="text-indigo-400 font-mono">{trailLength}</span>
                          </div>
                          <input 
                            type="range" min="100" max="10000" step="100" value={trailLength} 
                            onChange={(e) => setTrailLength(parseInt(e.target.value))}
                            className="w-full accent-indigo-500 h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
                          />
                        </div>
                      </div>
                    </div>

                    <div className="pt-4 border-t border-slate-800">
                      <div className="flex items-center gap-2 mb-3 text-slate-400">
                        <Target size={16} />
                        <h2 className="text-xs font-bold uppercase tracking-wider">Visualization</h2>
                      </div>
                      <div className="space-y-3">
                        <label className="flex items-center justify-between p-2 md:p-3 bg-slate-800/30 rounded-xl cursor-pointer hover:bg-slate-800/50 transition-colors">
                          <span className="text-xs md:text-sm font-medium">Show Inversion Circle</span>
                          <input 
                            type="checkbox" checked={showInversionCircle} 
                            onChange={() => setShowInversionCircle(!showInversionCircle)}
                            className="w-4 h-4 rounded accent-indigo-500"
                          />
                        </label>
                        
                        <button 
                          onClick={resetSimulation}
                          className="w-full flex items-center justify-center gap-2 py-2 md:py-3 rounded-xl border border-slate-700 hover:bg-slate-800 transition-all text-slate-300 font-semibold text-sm"
                        >
                          <RefreshCw size={14} />
                          Reset Path
                        </button>
                      </div>
                    </div>
                  </section>
                </aside>

                <div className="flex-1 min-h-[50vh] bg-[radial-gradient(circle_at_center,_#111827_0%,_#020617_100%)] relative">
                  <canvas 
                    ref={canvasRef} 
                    className="absolute inset-0 w-full h-full block"
                  />
                  
                  <div className="absolute bottom-4 left-4 right-4 flex justify-between items-end pointer-events-none">
                    <div className="bg-slate-900/80 backdrop-blur-md border border-slate-800 p-3 rounded-xl min-w-[150px] pointer-events-auto shadow-2xl">
                      <div className="flex items-center gap-2 mb-2">
                        <div className={`w-2 h-2 rounded-full ${isRunning ? 'bg-emerald-400 animate-pulse' : 'bg-rose-500'}`}></div>
                        <span className="text-[10px] font-bold text-slate-300 uppercase tracking-wider">Status</span>
                      </div>
                      <div className="space-y-1">
                        <div className="flex justify-between text-[10px]">
                          <span className="text-slate-500">Engine</span>
                          <span className={isRunning ? 'text-emerald-400 font-medium' : 'text-rose-400 font-medium'}>
                            {isRunning ? 'Active' : 'Paused'}
                          </span>
                        </div>
                        <div className="flex justify-between text-[10px]">
                          <span className="text-slate-500">Precision</span>
                          <span className="text-indigo-400 font-mono">{precision}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </main>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>